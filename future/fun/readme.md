# (Functional) Future

## –ü—Ä–µ—Ä–µ–∫–≤–∏–∑–∏—Ç—ã

- [sync/wait_group](/tasks/sync/wait_group)
- [sched/run_loop](/tasks/sched/run_loop)
- [future/contract](/tasks/future/contract)
- [—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è] [fiber/mutex](/tasks/fiber/mutex)

---

–î–æ —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –º—ã –ø–∏—Å–∞–ª–∏ (–∏ –¥—É–º–∞–ª–∏ –æ) concurrency –≤ –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–º —Å—Ç–∏–ª–µ, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–∫ —Å–µ—Ä–∏–∏ –º—É—Ç–∞—Ü–∏–π —Ä–∞–∑–¥–µ–ª—è–µ–º–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –Ω–∞–∑—ã–≤–∞—è –∏—Ö —Ñ–∞–π–±–µ—Ä–∞–º–∏. 

–í —ç—Ç–æ–π –∑–∞–¥–∞—á–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è [—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è](https://www.haskell.org/) –º–æ–¥–µ–ª—å (–∏ —è–∑—ã–∫) –¥–ª—è concurrency, –≤ –∫–æ—Ç–æ—Ä–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∫–∞–∫ –≥—Ä–∞—Ñ—ã —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏ –∏–º–µ–Ω—É—é—Ç—Å—è _—Ñ—å—é—á–∞–º–∏_ (_futures_).

## `Future`

–í –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–∏ –ª–µ–∂–∏—Ç –ø–æ–Ω—è—Ç–∏–µ _future_ (–¥–∞–ª–µ–µ ‚Äì –ø—Ä–æ—Å—Ç–æ _—Ñ—å—é—á–∞_) –∏ —à–∞–±–ª–æ–Ω `Future<T>`.

`Future<T>` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –±—É–¥—É—â–∏–π, –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤—ã–π, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏.

–ó–∞ —Ñ—å—é—á–µ–π –º–æ–∂–µ—Ç —Å—Ç–æ—è—Ç—å
- [–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤ –ø—É–ª–µ –ø–æ—Ç–æ–∫–æ–≤](exe/future/make/submit.hpp),
- [RPC](https://capnproto.org/cxxrpc.html),  
- [IO](https://tokio.rs/tokio/tutorial/io),
- [–æ–∂–∏–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–º–∞—Ñ–æ—Ä–µ](https://github.com/twitter/util/blob/143adbdf5bc6dc55eddb9248c597eeb11a799094/util-core/src/main/scala/com/twitter/concurrent/AsyncSemaphore.scala#L141),
- [—Ç–∞–π–º–∞—É—Ç](https://gitlab.com/Lipovsky/await/-/blob/3ff428941d6ccf414e0e4c9fd3831f883c6379f5/demo/main.cpp#L44) –∏ —Ç.–¥.

## `Result`

–§—å—é—á–∞ –º–æ–∂–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ —á—Ç–µ–Ω–∏–µ —Å –¥–∏—Å–∫–∞,
–∏ –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å, —á—Ç–æ –ø–æ–¥–æ–±–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –æ—à–∏–±–∫–æ–π.

–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Ç–∞–∫–∏—Ö (_fallible_, –¥–æ–ø—É—Å–∫–∞—é—â–∏—Ö —Å–±–æ–π) –æ–ø–µ—Ä–∞—Ü–∏–π –º—ã –±—É–¥–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å –≤ –≤–∏–¥–µ `Result<T>`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏–±–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–ø–∞ `T`, –ª–∏–±–æ –æ—à–∏–±–∫—É.

–ü–æ–ª–æ–∂–∏–º [`TryFuture<T>`](exe/future/type/result.hpp) = `Future<Result<T>>` ‚Äì _—Å–±–æ–π–Ω–∞—è_ —Ñ—å—é—á–∞.

## –ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã

–§—å—é—á–∏, —Ç.–µ. —Å—Ç–æ—è—â–∏–µ –∑–∞ –Ω–∏–º–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –º—ã –±—É–¥–µ–º –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ:

```cpp
future::TryFuture<Response> Hedge(Request request) {
  // primary ‚Äì —Å–±–æ–π–Ω–∞—è —Ñ—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è —É–¥–∞–ª–µ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ –∫ –Ω–µ–∫–æ—Ç–æ—Ä–æ–º—É —Å–µ—Ä–≤–∏—Å—É
  auto primary = Rpc(request);

  // "–ó–∞–ø–∞—Å–Ω–æ–π" –∑–∞–ø—Ä–æ—Å –∫ –¥—Ä—É–≥–æ–π —Ä–µ–ø–ª–∏–∫–µ —Å–µ—Ä–≤–∏—Å–∞, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–π –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏—é —Ç–∞–π–º–∞—É—Ç–∞
  auto backup = future::After(99ms) | future::FlatMap([request](Unit) {
    return Rpc(request);
  });
  
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (–∞ —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å –æ–ø–æ–∑–¥–∞–≤—à–∏–º –∑–∞–ø—Ä–æ—Å–æ–º?)
  return future::FirstOk(std::move(primary), std::move(backup));
}
``` 

–ù–∞ —ç—Ç–æ–º –Ω–µ–±–æ–ª—å—à–æ–º –ø—Ä–∏–º–µ—Ä–µ —Å _—Ö—ç–¥–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º_ (_hedging_) –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å–º. —Å—Ç–∞—Ç—å—é [Tail at Scale](https://www.barroso.org/publications/TheTailAtScale.pdf)) —Ö–æ—Ä–æ—à–æ –≤–∏–¥–Ω—ã –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∫ concurrency:

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –æ–ø–∏—Å—ã–≤–∞–µ—Ç **—á—Ç–æ** –∏ **–∫–æ–≥–¥–∞** –æ–Ω —Ö–æ—á–µ—Ç —Å–¥–µ–ª–∞—Ç—å, –∞ –∑–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —ç—Ç–æ–≥–æ –ø–ª–∞–Ω–∞ (–∏ –∑–∞ –≤—Å—é —Å–æ–ø—Ä—è–∂–µ–Ω–Ω—É—é —Å –Ω–∏–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é) –æ—Ç–≤–µ—á–∞—é—Ç –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã.

**–ú–µ–Ω—è–µ—Ç—Å—è –º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å** concurrency: —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –¥—É–º–∞–µ—Ç –Ω–µ –ø—Ä–æ —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ —Ä–∞–∑–¥–µ–ª—è–µ–º–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é, —Ç.–µ. –Ω–µ –ø—Ä–æ control flow, –∞ –ø—Ä–æ **—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π**, –∫–æ—Ç–æ—Ä—ã–µ "—Ç–µ–∫—É—Ç" –æ—Ç –ø—Ä–æ–¥—å—é—Å–µ—Ä–æ–≤ –∫ –∫–æ–Ω—Å—å—é–º–µ—Ä–∞–º, —Ç.–µ. –ø—Ä–æ **data flow**.

### üî• References

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –∫ –ø—Ä–æ—á—Ç–µ–Ω–∏—é!

- [Your Server as a Function](https://monkey.org/~marius/funsrv.pdf) by Marius Eriksen
- [Futures aren't Ersatz Threads](https://monkey.org/~marius/futures-arent-ersatz-threads.html) by Marius Eriksen

## –ú–æ–¥–µ–ª—å

–§—å—é—á–∏ ‚Äì –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Ü–µ–ø–æ—á–∫–∏ / –≥—Ä–∞—Ñ—ã –∑–∞–¥–∞—á –∏–ª–∏ (–≤ –æ–±—â–µ–º —Å–ª—É—á–∞–µ) ‚Äì –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

### –û–ø–µ—Ä–∞—Ü–∏–∏

- _–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã_ (`Contract`, `Submit`, `Value`, ...) –∏–ª–∏ _—Å–µ—Ä–≤–∏—Å—ã_ (—Å–º. [Your Server as a Function](https://monkey.org/~marius/funsrv.pdf)) —Å—Ç—Ä–æ—è—Ç —Ñ—å—é—á–∏ / –æ—Ç–∫—Ä—ã–≤–∞—é—Ç —Ü–µ–ø–æ—á–∫–∏,
- _–∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã_ (`Map`, `FlatMap`, `AndThen`, `OrElse`, ...) –ø–æ–ª—É—á–∞—é—Ç —Ñ—å—é—á–∏ –Ω–∞ –≤—Ö–æ–¥, –ø–æ–≥–ª–æ—â–∞—é—Ç –∏—Ö –∏ —Å—Ç—Ä–æ—è—Ç –Ω–æ–≤—ã–µ —Ñ—å—é—á–∏ / –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ü–µ–ø–æ—á–∫–∏,
- _—Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã_ (`Get`, `Detach`) –ø–æ–≥–ª–æ—â–∞—é—Ç —Ñ—å—é—á–∏ / –∑–∞–≤–µ—Ä—à–∞—é—Ç —Ü–µ–ø–æ—á–∫–∏.

_–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã_ –º–æ–¥–µ–ª–∏—Ä—É—é—Ç –ø—Ä–æ–¥—å—é—Å–µ—Ä–æ–≤, _—Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã_ ‚Äì –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤.

–í–º–µ—Å—Ç–µ –æ–Ω–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç –≥—Ä–∞—Ñ—ã –æ–ø–µ—Ä–∞—Ü–∏–π / –≤—ã—á–∏—Å–ª–µ–Ω–∏–π / –∑–∞–¥–∞—á.

### –õ–∏–Ω–µ–π–Ω–æ—Å—Ç—å

–§—å—é—á–∏ ‚Äì _–ª–∏–Ω–µ–π–Ω—ã–µ_ (_linear_): –∫–∞–∂–¥–∞—è —Ñ—å—é—á–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–≥–ª–æ—â–µ–Ω–∞ (–∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–º –∏–ª–∏ —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä–æ–º) **—Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑** (_exactly-once_).

#### C++

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ª–∏–Ω–µ–π–Ω–æ—Å—Ç—å –Ω–µ–ª—å–∑—è –≤—ã—Ä–∞–∑–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ —Ç–∏–ø–æ–≤ –°++ ‚òπÔ∏è.

–í –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±—É–µ–º: —Ñ—å—é—á–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ (_non-copyable_), —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ (_move-constructible_, _non-move-assignable_).

–ë—É–¥–µ–º —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ –Ω–µ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–Ω–∞—è —Ñ—å—é—á–∞ ‚Äì —ç—Ç–æ [implementation-defined behavior](https://eel.is/c++draft/defns.impl.defined).

## –ü—Ä–∏–º–µ—Ä

```cpp
void FuturesExample() {
  using namespace exe;
  
  sched::ThreadPool pool{4};
  pool.Start();
  
  auto pipeline = future::Just()  // <- –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –Ω–∞—á–∏–Ω–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É
      | future::Via(pool) 
      | future::Map([](Unit) {  // <- –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä
          fmt::println("Running on thread pool");
          return 42;
        }) 
      | future::FlatMap([&pool](int) {
        // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —à–∞–≥
        return future::Submit(pool, [] -> Result<int> {
          return result::Err(TimeoutError());  // –ö–æ—Ç–æ—Ä—ã–π –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –æ—à–∏–±–∫–æ–π
        };
      })
      | future::OrElse([](Error) {
          return future::Ok(7);  // fallback
        })
      | future::MapOk([](int v) {
          return v + 1;
        });
      
  auto r = future::Get(std::move(pipeline));  // <- —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä
  fmt::println("{}", *r);  // –ü–µ—á–∞—Ç–∞–µ—Ç 8
  
  pool.Stop();
}
```

–ë–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ ‚Äì –≤ [play/main.cpp](play/main.cpp)


## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `exe/future`

- `type` ‚Äì —Ç–∏–ø—ã
- `make` ‚Äì –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã
- `combine` ‚Äì –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã
  - `seq` ‚Äì –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è
  - `concur` ‚Äì –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è
- `terminate` ‚Äì —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã
- `syntax` ‚Äì –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

## –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã

_–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã_ ‚Äì —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä—É—é—â–∏–µ –Ω–æ–≤—ã–µ —Ñ—å—é—á–∏.

–ö–∞—Ç–∞–ª–æ–≥ –±–∞–∑–æ–≤—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤: [`future/make`](exe/future/make)

–§—Ä–µ–π–º–≤–æ—Ä–∫ RPC —Ä–∞—Å—à–∏—Ä–∏—Ç —ç—Ç–æ—Ç –±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ IO ‚Äì –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è / –∑–∞–ø–∏—Å–∏ –∏ —Ç.–¥.

---

### üëâ `Contract`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`make/contract.hpp`](exe/future/make/contract.hpp)

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –º–µ–∂–¥—É –ø—Ä–æ–¥—å—é—Å–µ—Ä–æ–º –∏ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–º:

```cpp
auto [f, p] = future::Contract<int>();

// Producer
std::thread producer([p = std::move(p)] mutable {
  std::move(p).Set(7);
});

// Consumer
auto v = future::Get(std::move(f));  // 7

producer.join();
```

–û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ —Å—Ç–æ—Ä–æ–Ω:

- –ø—Ä–æ–¥—å—é—Å–µ—Ä –æ–±—è–∑–∞–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ—å—é—á—É —Å –ø–æ–º–æ—â—å—é `Set`,
- –∫–æ–Ω—Å—å—é–º–µ—Ä –æ–±—è–∑–∞–Ω –ø–æ—Ç—Ä–µ–±–∏—Ç—å —Ñ—å—é—á—É —Å –ø–æ–º–æ—â—å—é –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∞ –∏–ª–∏ —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä–∞.

---

### üëâ `Submit`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`make/submit.hpp`](exe/future/make/submit.hpp)

–§—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ –∑–∞–¥–∞—á.

```cpp
auto f = future::Submit(pool, [] {
  return 7;
});
```

---

### üëâ `Ready`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`make/ready.hpp`](exe/future/make/ready.hpp)

–§—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –≥–æ—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

```cpp
auto f = future::Ready(result::Ok(2));
```

---

### üëâ `Value`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`make/value.hpp`](exe/future/make/value.hpp)

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ `Ready`, –Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π: `Result<T>` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–¥–∞.

```cpp
auto f = future::Value(7);
```

---

### üëâ `Return`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`make/return.hpp`](exe/future/make/return.hpp)

–°–∏–Ω–æ–Ω–∏–º –¥–ª—è `Ready`, –æ—Ç—Å—ã–ª–∞—é—â–∏–π —á–∏—Ç–∞—Ç–µ–ª—è –∫ [–º–æ–Ω–∞–¥–∞–º](https://wiki.haskell.org/Typeclassopedia).

```cpp
auto f = future::Return(7);
```

---

### üëâ `Just`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`make/just.hpp`](exe/future/make/just.hpp)

–§—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –≥–æ—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–ø–∞ [`Unit`](exe/result/type/unit.hpp).

```cpp
auto f = future::Just()
    | future::Via(pool) 
    | future::Map([](Unit) {
        return 42;
      });
```

#### Unit

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è, –º–æ–¥–µ–ª–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `Future<Unit>`: 

https://en.wikipedia.org/wiki/Unit_type

–§—å—é—á–∏ ‚Äì —ç—Ç–æ –±—É–¥—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–æ –∑–Ω–∞—á–µ–Ω–∏–π —Ç–∏–ø–∞ `void` –Ω–µ –±—ã–≤–∞–µ—Ç, –∑–Ω–∞—á–∏—Ç –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏ –±—É–¥—É—â–∏—Ö `void`-–æ–≤.

## –ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã

_–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã_ ‚Äì —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–∞—é—Ç —Ñ—å—é—á–∏ –Ω–∞ –≤—Ö–æ–¥ (–ø–æ—Ç—Ä–µ–±–ª—è—é—Ç –∏—Ö) –∏ —Å—Ç—Ä–æ—è—Ç –Ω–æ–≤—ã–µ —Ñ—å—é—á–∏.

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è

–ö–∞—Ç–∞–ª–æ–≥: [`future/combine/seq`](exe/future/combine/seq)

#### Pipeline operator

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Ñ—å—é—á –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –≤—ã—Ä–∞–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –æ–ø–µ—Ä–∞—Ç–æ—Ä `|` (_pipeline operator_). 

–û–ø–µ—Ä–∞—Ç–æ—Ä –Ω–µ –∏–º–µ–µ—Ç –ø—Ä—è–º–æ–≥–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ —Ñ—å—é—á–∞–º, –æ–Ω —Ä–µ—à–∞–µ—Ç –±–æ–ª–µ–µ –æ–±—â—É—é –∑–∞–¥–∞—á—É: —É–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ø–æ—á–µ–∫ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π, –≥–¥–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–π –≤—ã–∑–æ–≤ –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ –≤—ã—Ö–æ–¥ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ. 

–í—ã—Ä–∞–∂–µ–Ω–∏–µ `f(a) | h(x, y)` –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º `|` –≤ `h(f(a), x, y)`

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ `|` –¥–ª—è —Ñ—å—é—á: [future/syntax/pipe.hpp](exe/future/syntax/pipe.hpp)

##### References

–° –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `|` –º—ã —ç–º—É–ª–∏—Ä—É–µ–º "–Ω–∞—Å—Ç–æ—è—â–∏–π" (–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≤ —è–∑—ã–∫–µ –°++) –æ–ø–µ—Ä–∞—Ç–æ—Ä `|>`:

- [OCaml] [Pipelining](https://cs3110.github.io/textbook/chapters/hop/pipelining.html)
- [JavaScript] [Pipe Operator (|>) for JavaScript](https://github.com/tc39/proposal-pipeline-operator/)
- [C++] [Exploring the Design Space for a Pipeline Operator](https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2022/p2672r0.html)

---

#### üëâ `Map` 

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`combine/seq/map.hpp`](exe/future/combine/seq/map.hpp)

–°–∏–≥–Ω–∞—Ç—É—Ä–∞: `Future<T>` ‚Üí (`T` ‚Üí `U`) ‚Üí `Future<U>` ([–Ω–æ—Ç–∞—Ü–∏—è](https://www.haskell.org/tutorial/functions.html) –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∞ –∏–∑ Haskell)

–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä `Map` –ø—Ä–∏–º–µ–Ω—è–µ—Ç (–≤ –±—É–¥—É—â–µ–º) —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (_–º–∞–ø–ø–µ—Ä_) –∫ –∑–Ω–∞—á–µ–Ω–∏—é –≤—Ö–æ–¥–Ω–æ–π —Ñ—å—é—á–∏:

```cpp
auto f = future::Value(1) | future::Map([](int v) {
  return v + 1;
});
```

–ö–∞–∫ –∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä, `Map` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Ñ—å—é—á–µ **–±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è** –±—É–¥—É—â–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –æ–Ω –ª–∏—à—å –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Ö–æ–¥–Ω–æ–π —Ñ—å—é—á–∏ –∏ —Å—Ç—Ä–æ–∏—Ç –Ω–æ–≤—É—é (–≤—ã—Ö–æ–¥–Ω—É—é) —Ñ—å—é—á—É.

---

#### üëâ `Via`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`combine/seq/via.hpp`](exe/future/combine/seq/via.hpp)

##### –ì–æ–Ω–∫–∞

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä:

```cpp
// –ì–æ–Ω–∫–∞ –º–µ–∂–¥—É –ø—Ä–æ–¥—å—é—Å–µ—Ä–æ–º –∏ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–º
auto f = future::Submit(pool, [] { return 7; })
    | future::Map([](int v) { return v + 1; });
```

–ü–æ—Ç–æ–∫, –≤ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –º–∞–ø–ø–µ—Ä, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫ —É–ø–æ—Ä—è–¥–æ—á–∞—Ç—Å—è –ø—Ä–∏ —Ä–∞–Ω–¥–µ–≤—É
- –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ –ø—É–ª–µ –ø–æ—Ç–æ–∫–æ–≤ –∏ 
- –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–µ `Map`.

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–ª–∞–Ω–∏—Ä—É—é—â–∏–π —Å –ø–æ–º–æ—â—å—é —Ñ—å—é—á —Ü–µ–ø–æ—á–∫—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π, 
–¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞ —Ç–µ–º, –≤ –∫–∞–∫–æ–º –ø–æ—Ç–æ–∫–µ (–≤–µ—Ä–Ω–µ–µ, –≤ –∫–∞–∫–æ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ) –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∫–∞–∂–¥—ã–π –µ–µ —à–∞–≥.

–¢–∞–∫–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–∞–µ—Ç –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä `Via`: 

```cpp
auto f = future::Submit(pool, [] { return 7; })
    | future::Via(pool)  // <- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    | future::Map([](int value) {
        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –ø—É–ª–µ –ø–æ—Ç–æ–∫–æ–≤ `pool`
        fmt::println("Running on thread pool");
        return result::Ok()
      });
```

–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —á–µ—Ä–µ–∑ `Via` –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ **–Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è** –ø–æ —Ü–µ–ø–æ—á–∫–µ (–ø–æ–∫–∞ –Ω–µ –≤—Å—Ç—Ä–µ—Ç–∏—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä –∏–ª–∏ –Ω–æ–≤—ã–π `Via`).

##### `Inline`

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äì [`Inline`](exe/sched/inline.hpp).

##### State

–ú–æ–∂–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ `Via` ‚Äì —ç—Ç–æ –º—É—Ç–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è "–ø—Ä–æ—Å–æ—á–∏–ª–∞—Å—å" –≤ _—á–∏—Å—Ç—É—é_ (_pure_) —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å.

---

#### üëâ `Flatten`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`combine/seq/flatten.hpp`](exe/future/combine/seq/flatten.hpp)

–°–∏–≥–Ω–∞—Ç—É—Ä–∞: `Future<Future<T>>` ‚Üí `Future<T>`

"–£–ø–ª–æ—â–∞–µ—Ç" –≤–ª–æ–∂–µ–Ω–Ω—É—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:

```cpp
future::Future<int> f = future::Submit(pool, [&pool] {
  return future::Submit(pool, [] {
    return 7;
  })
}) | future::Flatten();
```

---

#### üëâ `FlatMap`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`combine/seq/flat_map.hpp`](exe/future/combine/seq/flat_map.hpp)

–°–∏–≥–Ω–∞—Ç—É—Ä–∞: `Future<T>` ‚Üí (`T` ‚Üí `Future<U>`) ‚Üí `Future<U>`

–ü–ª–∞–Ω–∏—Ä—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ –∑–∞–¥–∞—á.

```cpp
future::Future<int> f = future::Submit(pool, [] { return 1; }) 
    | future::FlatMap([&pool](int v) {
        return future::Submit(pool, [v] {
          return v + 1;
        });
      });   
```

##### –ú–æ–Ω–∞–¥—ã

–§—å—é—á–∏ —Å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º `Return` (`return`) –∏ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–º `FlatMap` (`>>=`) –æ–±—Ä–∞–∑—É—é—Ç [–º–æ–Ω–∞–¥—É](https://wiki.haskell.org/All_About_Monads#The_Monad_class).

---

#### `TryFuture<T>`

–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã –¥–ª—è `TryFuture<T>`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–±–æ–π–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

##### üëâ `AndThen` / `OrElse`

–ó–∞–≥–æ–ª–æ–≤–∫–∏:
- [`combine/seq/result/and_then.hpp`](exe/future/combine/seq/result/and_then.hpp)
- [`combine/seq/result/or_else.hpp`](exe/future/combine/seq/result/or_else.hpp)

–°–∏–≥–Ω–∞—Ç—É—Ä–∞:
- `AndThen`: `TryFuture<T>` ‚Üí (`T` ‚Üí `TryFuture<U>`) ‚Üí `TryFuture<U>`
- `OrElse`: `TryFuture<T>` ‚Üí (`Error` ‚Üí `TryFuture<T>`) ‚Üí `TryFuture<T>`

–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã `AndThen` / `OrElse` —Ä–∞–∑–¥–µ–ª—è—é—Ç —É—Å–ø–µ—à–Ω—ã–π –ø—É—Ç—å / –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–∫–∏ –≤ —Ü–µ–ø–æ—á–∫–µ —Å–±–æ–π–Ω—ã—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤:
- `AndThen` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è—Ö,
- `OrElse` ‚Äì —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—à–∏–±–∫–∞—Ö.

```cpp
auto f = future::Just() 
    | future::Map([] -> Result<int> {  // Fallible
        return result::Err(IoError());
      })
    | future::AndThen([](int v) {
        return future::Ok(v + 1);  // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ result::Ok
      })
    | future::OrElse([](Error) {
        return future::Ok(7);  // Fallback
      });
```

–ù–µ—Ç—Ä—É–¥–Ω–æ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ `AndThen` / `OrElse` ‚Äì —ç—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–æ–≥ –¥–ª—è –±–ª–æ–∫–∞ `try` / `catch`.

##### üëâ `MapOk`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`combine/seq/result/map_ok.hpp`](exe/future/combine/seq/result/map_ok.hpp)

–°–∏–≥–Ω–∞—Ç—É—Ä–∞: `TryFuture<T>` ‚Üí (`T` ‚Üí `U`) ‚Üí `TryFuture<U>`

–í–∞—Ä–∏–∞—Ü–∏—è `Map` –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—É—Ç–∏ –≤ —Å–±–æ–π–Ω–æ–π —Ñ—å—é—á–µ:

```cpp
auto f = future::Ready(result::Ok(1))
     | future::MapOk([](int v) {
         return v + 2;
       });
```

### Concurrent –∫–æ–º–ø–æ–∑–∏—Ü–∏—è

–ö–∞—Ç–∞–ª–æ–≥: [`combine/concur`](exe/future/combine/concur)

---

#### üëâ `First`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`combine/concur/first.hpp`](exe/future/combine/concur/first.hpp)

–§—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –ø–µ—Ä–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—å—é—á, –ø–æ–¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤—Ö–æ–¥.

```cpp
auto timeout = future::After(1s) 
    | future::Map([](Unit) -> Result<int> {
        return result::Err(TimeoutError());
      });

auto compute = future::Submit(pool, [] -> Result<int> {
  return 7;  // ~ –¢—è–∂–µ–ª–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ
});

// –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
auto compute_with_timeout = future::First(std::move(compute), std::move(timeout));

// –ü–µ—Ä–≤—ã–π –≥–æ—Ç–æ–≤—ã–π Result
auto result = future::Get(std::move(compute_with_timeout));
```

–¢–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è –≤—Ö–æ–¥–Ω—ã—Ö —Ñ—å—é—á –Ω–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è.

#### üëâ `FirstOk`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`combine/concur/result/first.hpp`](exe/future/combine/concur/result/first.hpp)

–í–∞—Ä–∏–∞—Ü–∏—è `First` –¥–ª—è `TryFuture`.

–§—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –ø–µ—Ä–≤—ã–π —É—Å–ø–µ—Ö / –ø–æ—Å–ª–µ–¥–Ω—é—é –æ—à–∏–±–∫—É –¥–≤—É—Ö —Å–±–æ–π–Ω—ã—Ö —Ñ—å—é—á, –ø–æ–¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤—Ö–æ–¥.

–°–º. –ø—Ä–∏–º–µ—Ä —Å —Ö–µ–¥–∂–∏—Ä–æ–≤–∞–Ω–∏–µ–º RPC.

---

#### üëâ `Both` / `All`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`combine/concur/all.hpp`](exe/future/combine/concur/all.hpp)

–§—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –ø–∞—Ä—É (–∫–æ—Ä—Ç–µ–∂) –∑–Ω–∞—á–µ–Ω–∏–π —Ñ—å—é—á, –ø–æ–¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤—Ö–æ–¥:

```cpp
auto f = future::Submit(pool, [] { return 1; });
auto g = future::Submit(pool, [] { return 2; });

// –ë–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è
auto both = future::Both(std::move(f), std::move(g));

// –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–∂–∏–¥–∞–µ–º –¥–≤—É—Ö –∑–Ω–∞—á–µ–Ω–∏–π
auto [x, y] = future::Get(std::move(both));
```

–¢–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è –≤—Ö–æ–¥–Ω—ã—Ö —Ñ—å—é—á –Ω–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è.

##### üëâ `BothOk` / `AllOk` 

–í–∞—Ä–∏–∞—Ü–∏—è `Both` –¥–ª—è `TryFuture`.

–§—å—é—á–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∞—è –æ–±–∞ (–≤—Å–µ) –∑–Ω–∞—á–µ–Ω–∏—è / –ø–µ—Ä–≤—É—é –æ—à–∏–±–∫—É —Å–±–æ–π–Ω—ã—Ö —Ñ—å—é—á, –ø–æ–¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤—Ö–æ–¥.

##### Short-circuit

–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ —Ñ—å—é—á–∏ `BothOk` **–Ω–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–∞** –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–∞—Å–ø–∞–∫–æ–≤–∫–µ
–¥–≤—É—Ö —Ñ—å—é—á `f` –∏ `g`: –µ—Å–ª–∏ –≤—Ç–æ—Ä–∞—è —Ñ—å—é—á–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –æ—à–∏–±–∫–æ–π, —Ç–æ –æ–∂–∏–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π –±—É–¥–µ—Ç –ø—Ä–µ—Ä–≤–∞–Ω–æ.

---

#### –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã **—Å–±—Ä–∞—Å—ã–≤–∞—é—Ç** –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –¥–æ `Inline`, —Ç–∞–∫ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —è–≤–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ –ø–æ—Å–ª–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ü–µ–ø–æ—á–µ–∫.

## –¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã

_–¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã_ –∑–∞–≤–µ—Ä—à–∞—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏ / –≥—Ä–∞—Ñ—ã.

–ö–∞—Ç–∞–ª–æ–≥: [`future/terminate`](exe/future/terminate)

---

### üëâ `Get`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`terminate/get.hpp`](exe/future/terminate/get.hpp)

–¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä `Get` –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ—å—é—á–∏:

```cpp
// –ü–ª–∞–Ω–∏—Ä—É–µ–º –∑–∞–¥–∞—á—É –≤ –ø—É–ª –ø–æ—Ç–æ–∫–æ–≤
auto f = future::Submit(pool, [] {
  return result::Ok(7);
});

// –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ—Ç–æ–∫ –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
auto r = future::Get(std::move(f));
```

–ò–Ω–∞—á–µ –≥–æ–≤–æ—Ä—è, `Get` —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ "—Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç" `Future` –≤ –µ—ë `ValueType`.

#### Chaining

–¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä `Get` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º `|`:

```cpp
auto r = future::Submit(pool, [] { return result::Ok(7); })
          | future::Get();
```

---

### üëâ `Detach`

–ó–∞–≥–æ–ª–æ–≤–æ–∫: [`terminate/detach.hpp`](exe/future/terminate/detach.hpp)

`Future` –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∫–∞–∫ [`[[nodiscard]]`](https://en.cppreference.com/w/cpp/language/attributes/nodiscard) –∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —è–≤–Ω–æ –ø–æ–≥–ª–æ—â–µ–Ω–∞ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–º. 

–¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä `Detach` –ø–æ–≥–ª–æ—â–∞–µ—Ç —Ñ—å—é—á—É –∏ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –µ–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

```cpp
// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ –ø—É–ª–µ –Ω–∞—Å –Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç
future::Submit(pool, [] { /* ... */ }) 
    | future::Detach();
```

## –û–ø–µ—Ä–∞—Ç–æ—Ä—ã

–í [`future/syntax`](exe/future/syntax) —Å–æ–±—Ä–∞–Ω—ã –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è —Ñ—å—é—á:

- `f | c` –æ–∑–Ω–∞—á–∞–µ—Ç `c.Pipe(f)`
- `f or g` –æ–∑–Ω–∞—á–∞–µ—Ç `First(f, g)`
- `f + g` –æ–∑–Ω–∞—á–∞–µ—Ç `Both(f, g)`

## –õ—è–º–±–¥—ã

–≠—Ä–≥–æ–Ω–æ–º–∏–∫–∞ —Ñ—å—é—á —Å–∏–ª—å–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ª–∞–∫–æ–Ω–∏—á–Ω–æ—Å—Ç–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

–°—Ä–∞–≤–Ω–∏—Ç–µ:
- `[](int v) { return v + 1; }` (C++)
- `|v| v + 1` ([Rust](https://doc.rust-lang.org/rust-by-example/fn/closures.html))
- `_ + 1` ([Scala](https://docs.scala-lang.org/scala3/book/fun-anonymous-functions.html))

## –ó–Ω–∞—á–µ–Ω–∏—è

–ö–∞–∫ –≤—ã –º–æ–∂–µ—Ç–µ –≤–∏–¥–µ—Ç—å, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ñ—å—é—á–∞–º–∏ –∫–∞–∫ —Å **–∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏**, —Ç.–µ. –ø–µ—Ä–µ–¥–∞–µ—Ç (—Ç–æ—á–Ω–µ–µ, –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç)
–∏—Ö –≤ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã –∏ —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã.

## `Result`

[`Result<T>`](exe/result/type/result.hpp) ‚Äì —ç—Ç–æ alias –¥–ª—è `std::expected<T, E>`, –≥–¥–µ `E` = [`Error`](exe/result/type/error.hpp) = `std::error_code`.

### `Error`

–ú—ã —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –≤ —Ö–æ—Ä–æ—à–µ–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–µ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–≤–æ–±–æ–¥–∞ –≤ –≤—ã–±–æ—Ä–µ —Ç–∏–ø–∞ `E`.

–•–æ—Ä–æ—à–∏–π —Ç–∏–ø –æ—à–∏–±–∫–∏ –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å:
- –¥–æ–±–∞–≤–ª—è—Ç—å –∫ –æ—à–∏–±–∫–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç (source location, correlation id –∏ —Ç.–¥.)
- –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏

### –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã

#### `Ok`

–ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ –ª—è–º–±–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø:

```cpp
auto f = future::Value(7) | future::Map([](int v) {
  return result::Ok(v + 1);
);
```

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:

```cpp
auto f = future::Value(7) | future::Map([](int v) -> Result<int> {
  return v + 1;   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É–ø–∞–∫–æ–≤–∫–∞
);
```

#### `Err`

```cpp
// Status ‚Äì alias –¥–ª—è Result<Unit>
auto f = future::Submit(pool, []() -> Result<int> {
  return result::Err(TimeoutError());  // –¢–∏–ø –∑–Ω–∞—á–µ–Ω–∏—è –≤—ã–≤–æ–¥–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
});
```

### –ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã

```cpp
auto r = result::Ok(2)
      | result::Map([](int v) { return v + 1; })
      | result::AndThen([](int v) {
          return result::Ok(v + 2);  
        })
      | result::OrElse([](Error) {
        return result::Ok(42);  // Fallback
      });
```

## –ó–∞–¥–∞–Ω–∏–µ

1) –†–µ–∞–ª–∏–∑—É–π—Ç–µ `future::Contract` + `future::Get` —Å –ø–æ–º–æ—â—å—é wait-free —Ä–∞–Ω–¥–µ–≤—É –∏ –ø–æ–¥–ø–∏—Å–∫–∏ —Å –∫–æ–ª–ª–±—ç–∫–æ–º
2) –ü—Ä–æ—á—Ç–∏—Ç–µ —Å—Ç–∞—Ç—å—é [Your Server as a Function](https://monkey.org/~marius/funsrv.pdf)
3) –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ñ—å—é—á–∏
   1) –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã
   2) –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã
   3) –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã
4) [–ü–æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å —è–∑—ã–∫–æ–º Haskell](https://www.haskell.org/tutorial/), –º—ã –∫ –Ω–µ–º—É –µ—â–µ –≤–µ—Ä–Ω–µ–º—Å—è
5) –ü–æ—Ä–∞–∑–º—ã—à–ª—è–π—Ç–µ –Ω–∞–¥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π —Ñ—å—é—á
6) –ò–∑—É—á–∏—Ç–µ –∫–∞—Ç–∞–ª–æ–≥–∏ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö / —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞—Ö, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

#### –§–∞–π–±–µ—Ä—ã

–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `fiber::Await` –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π —Ñ—å—é—á–∏ –≤ —Ñ–∞–π–±–µ—Ä–µ:

```cpp
fiber::Go(pool, [&pool] {
  auto f = future::Submit(pool, [] {
    return 1;
  };
  
  auto g = future::Submit(pool, [] {
    return 2;
  });
  
  // –ë–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è
  auto first = std::move(f) or std::move(g);
  
  // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–±–µ—Ä –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –æ–¥–Ω–æ–≥–æ –∏–∑ –≤—Ö–æ–¥–æ–≤ First
  // fiber/sched/await.hpp
  auto v = fiber::Await(std::move(first));
  
  fmt::println("first -> {}", v);
});
```

[–¢–µ—Å—Ç—ã](pipelines/fiber/sched/await.json)

#### `First` & `All`

(–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å)

–ù–∞–ø–∏—à–∏—Ç–µ variadic –≤–µ—Ä—Å–∏–∏ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–≤ `First` –∏ `All` (–æ–±–æ–±—â–µ–Ω–∏–µ `Both`).

#### `Result<T, E>`

(–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å)

–ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π —Ç–∏–ø `E` –¥–ª—è `Result`.

#### `Unit`

–°–∫—Ä–æ–π—Ç–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `Unit`-—ã:

```cpp
auto f = future::Just() | future::Via(pool) | future::Map([] {
  // –ú–∞–ø–ø–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–ø–∞ Unit
  return 7;  
});
```

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

–ó–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–≤—è–∑—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ñ—å—é—á –∏ –¥–æ–ø—É—Å–∫–∞–µ—Ç –±–æ–ª—å—à—É—é —Å—Ç–µ–ø–µ–Ω—å —Å–≤–æ–±–æ–¥—ã –≤ –µ–µ –≤—ã–±–æ—Ä–µ. 

–ù–æ –±—É–¥–µ—Ç —Ä–∞–∑—É–º–Ω–æ –Ω–∞—á–∞—Ç—å —Å —Å–∞–º–æ–π –Ω–∞–∏–≤–Ω–æ–π –∏ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π, –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –∑–∞–¥—É–º–∞—Ç—å—Å—è –æ —Ç–æ–º, —á—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ª—É—á—à–µ.

–ù–∞—à–∞ –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å –Ω–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ ‚Äì –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º –∫ concurrency –∏ –æ—Å–≤–æ–∏—Ç—å
 –¥–æ–≤–æ–ª—å–Ω–æ –æ–±—à–∏—Ä–Ω—ã–π —è–∑—ã–∫ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–≤.

### –ö–æ–ª–ª–±—ç–∫–∏

–ó–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º `Get`, –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—å—é—á –Ω–∏–≥–¥–µ –Ω–µ—Ç –±–ª–æ–∫–∏—Ä—É—é—â–µ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è!

–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –º–µ—Ö–∞–Ω–∏–∫–∞ –≤—Å–µ—Ö –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–æ–≤ –∏ —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä–æ–≤ ‚Äì –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –ø–æ–º–æ—â—å—é –∫–æ–ª–ª–±—ç–∫–∞.

–ù–∞–ø—Ä–∏–º–µ—Ä, 
- –≤ `Map` –∫–æ–ª–ª–±—ç–∫ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫ –º–∞–ø–ø–µ—Ä–∞ –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ –∑–∞–¥–∞—á,
- –≤ `Get` –∫–æ–ª–ª–±—ç–∫ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –±—É–¥–∏—Ç –∂–¥—É—â–∏–π –ø–æ—Ç–æ–∫,
- –≤ `First` ‚Äì "–≥–æ–Ω—è–µ—Ç—Å—è" —Å –∫–æ–ª–ª–±—ç–∫–æ–º –¥—Ä—É–≥–æ–≥–æ "–≤—Ö–æ–¥–∞" –∑–∞ –ø—Ä–∞–≤–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—ã—Ö–æ–¥–Ω—É—é —Ñ—å—é—á—É.

### –¢–∏–ø—ã –∫–æ–ª–ª–±—ç–∫–æ–≤

–†–∞–∑–¥–µ–ª–∏–º –∫–æ–ª–ª–±—ç–∫–∏ –Ω–∞ –¥–≤–∞ –∫–ª–∞—Å—Å–∞:

1) –í –∫–æ–ª–ª–±—ç–∫–µ –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∞—Ö `Map` –∏ `AndThen`)
2) –í –∫–æ–ª–ª–±—ç–∫–µ –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è **—Å–ª—É–∂–µ–±–Ω—ã–π –∫–æ–¥** –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Flatten` –∏–ª–∏ `First`) –∏–ª–∏ —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä–∞ (`Get` –¥–ª—è –ø–æ—Ç–æ–∫–∞ –∏–ª–∏ `Await` –¥–ª—è —Ñ–∞–π–±–µ—Ä–∞)

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

–ü–æ—Ç—Ä–µ–±—É–µ–º, —á—Ç–æ–±—ã –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–º–∞–ø–ø–µ—Ä) –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª–Ω—è–ª—Å—è –≤ –≤–∏–¥–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∑–∞–¥–∞—á–∏
–≤ —è–≤–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ.

#### –°–ª—É–∂–µ–±–Ω—ã–µ –∫–æ–ª–ª–±—ç–∫–∏

–ü–æ—Ç—Ä–µ–±—É–µ–º, —á—Ç–æ–±—ã —Å–ª—É–∂–µ–±–Ω—ã–µ –∫–æ–ª–ª–±—ç–∫–∏ –≤—Å–µ–≥–¥–∞ –∏–Ω–ª–∞–π–Ω–∏–ª–∏—Å—å (—Å–º. `Inline`).

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

–§—å—é—á–∞–º –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–∑–∞–∏–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –≤—Å–µ —Ç–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä—ã –∏ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä—ã –≤
–∑–∞–¥–∞—á–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ wait-free.

## References

### Futures

- [Your Server as a Function](https://monkey.org/~marius/funsrv.pdf)
- [Futures aren't Ersatz Threads](https://monkey.org/~marius/futures-arent-ersatz-threads.html)
- [–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏](https://habr.com/ru/companies/jugru/articles/446562/)

#### In the Wild

- [com.twitter.util.Future](https://twitter.github.io/util/docs/com/twitter/util/Future.html), [Twitter Futures](https://twitter.github.io/finagle/guide/Futures.html)
- [Rust Futures](https://docs.rs/futures/latest/futures/)
- [cats.effect.IO](https://typelevel.org/cats-effect/api/3.x/cats/effect/IO.html)
- [Futures for C++11 at Facebook](https://engineering.fb.com/2015/06/19/developer-tools/futures-for-c-11-at-facebook/), [Folly Futures](https://github.com/facebook/folly/blob/main/folly/docs/Futures.md)
- [YTsaurus Futures](https://github.com/ytsaurus/ytsaurus/tree/main/yt/yt/core/actions)    

### Errors

- [The Error Model](https://joeduffyblog.com/2016/02/07/the-error-model/)

### Haskell

- https://www.haskell.org/
- [A Gentle Introduction to Haskell](https://www.haskell.org/tutorial/)

### Linear types

- [Substructural type system](https://en.wikipedia.org/wiki/Substructural_type_system)
- [Linear Haskell](https://arxiv.org/pdf/1710.09756.pdf)

### Monads

#### Introduction

- [About monads](https://www.haskell.org/tutorial/monads.html)
- [All About Monads](https://wiki.haskell.org/All_About_Monads)

#### Deep Dive

- [Monads for functional programming](https://homepages.inf.ed.ac.uk/wadler/papers/marktoberdorf/baastad.pdf)
- [Imperative functional programming](https://www.microsoft.com/en-us/research/wp-content/uploads/1993/01/imperative.pdf)
- [Typeclassopedia](https://wiki.haskell.org/Typeclassopedia)
- [A monad is just a monoid in the category of endofunctors, what's the problem?](https://stackoverflow.com/questions/3870088/a-monad-is-just-a-monoid-in-the-category-of-endofunctors-whats-the-problem)
- [Functors, Applicatives, And Monads In Pictures](https://www.adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html)
- [Abstraction, intuition, and the ‚Äúmonad tutorial fallacy‚Äù](https://byorgey.wordpress.com/2009/01/12/abstraction-intuition-and-the-monad-tutorial-fallacy/)

