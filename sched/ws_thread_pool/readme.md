# Work-Stealing ThreadPool

## –ü—Ä–µ—Ä–µ–∫–≤–∏–∑–∏—Ç—ã

- [fiber/mutex](/tasks/fiber/mutex)
- [fiber/channel](/tasks/fiber/channel)  
- [sched/intrusive](/tasks/sched/intrusive)
- [lf/ws_queue](/tasks/lf/ws_queue)

----

> _I suspect that making the scheduler use per-CPU
> queues together with some inter-CPU load balancing
> logic is probably trivial. Patches already exist, and I
> don‚Äôt feel that people can screw up the few hundred lines
> too badly._ 
> 
> ‚Äì Linus Torvalds, 15 Dec 2001

[LKML](https://lkml.org/lkml/2001/12/15/32)

----

–í —ç—Ç–æ–π –∑–∞–¥–∞—á–µ –º—ã –Ω–∞–ø–∏—à–µ–º [–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫](exe/sched/tp/fast) –¥–ª—è —Ñ–∞–π–±–µ—Ä–æ–≤, —Ñ—å—é—á –∏ stackless –∫–æ—Ä—É—Ç–∏–Ω.

–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å —Ä–æ—Å—Ç–æ–º —á–∏—Å–ª–∞ —è–¥–µ—Ä –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –±–æ–ª—å—à–µ –∑–∞–¥–∞—á –≤ –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏.

## –ò–¥–µ–∏

–ò–∑ —Å—Ä–µ–¥—Å—Ç–≤ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—ã–±–µ—Ä–µ–º –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏ —Ñ–∞–π–±–µ—Ä—ã (–Ω–æ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è –Ω–∏–∂–µ –±—É–¥—É—Ç –≤ —Ä–∞–≤–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã –∏ –¥–ª—è —Ñ—å—é—á, –∏ –¥–ª—è stackless –∫–æ—Ä—É—Ç–∏–Ω).

–î–æ —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ —Ñ–∞–π–±–µ—Ä–æ–≤ –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –ø—Ä–æ—Å—Ç–æ–π –ø—É–ª –ø–æ—Ç–æ–∫–æ–≤ —Å —Ä–∞–∑–¥–µ–ª—è–µ–º–æ–π –æ—á–µ—Ä–µ–¥—å—é –∑–∞–¥–∞—á.

–¢–∞–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—É–ª–∞ —Ö–æ—Ä–æ—à–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∑–∞–¥–∞—á. –ù–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –æ–Ω–∞ —Ñ–∞–π–±–µ—Ä–∞–º?

### –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–¥–∞—á–∏ –∏ contention –Ω–∞ –æ—á–µ—Ä–µ–¥–∏

–ó–∞–¥–∞—á–∏ —Ñ–∞–π–±–µ—Ä–æ–≤ –ø–æ–ª—É—á–∞—é—Ç—Å—è –æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–º–∏, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ contention –Ω–∞ –º—å—é—Ç–µ–∫—Å–µ —Ä–∞–∑–¥–µ–ª—è–µ–º–æ–π –æ—á–µ—Ä–µ–¥–∏ –ø—É–ª–∞ –ø–æ—Ç–æ–∫–æ–≤, —á—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å.

–£–±–µ–¥–∏—Ç–µ—Å—å –≤ —ç—Ç–æ–º, –ø–æ—Å–º–æ—Ç—Ä–µ–≤ –Ω–∞ flame graph –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ `fiber::BufferedChannel`.

–ï—Å–ª–∏ –º—ã –∏–∑–±–∞–≤–∏–º—Å—è –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ –æ—Ç —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–¥–µ–ª—è–µ–º—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –±—ã—Å—Ç—Ä–æ–º –ø—É—Ç–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏, —Ç–æ –ø–æ–ª—É—á–∏–º —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å.

### –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è, –ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∫—ç—à–∏

–§–∞–π–±–µ—Ä–∞–º —Å–≤–æ–π—Å—Ç–≤–µ–Ω–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥—É —Å–æ–æ–±—â–µ–Ω–∏—è: —è–≤–Ω–æ (—á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª—ã) –∏–ª–∏ –Ω–µ—è–≤–Ω–æ (—á–µ—Ä–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ–∫—Ü–∏–∏ –º—å—é—Ç–µ–∫—Å–æ–≤).

–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –æ–±—â—É—é –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –ø–ª–æ—Ö–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–∞–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤: –ø–æ–ª—É—á–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ 
—Å–ª–∏—à–∫–æ–º –ø–æ–∑–¥–Ω–æ, –∫–æ–≥–¥–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –µ–º—É –¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤—ã—Ç–µ—Å–Ω–µ–Ω—ã –∏–∑ –∫—ç—à–∞.

–ï—Å–ª–∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—è "—Å–æ–æ–±—â–µ–Ω–∏—è" –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ —Ç–æ–º –∂–µ —è–¥—Ä–µ, –≥–¥–µ —Ä–∞–±–æ—Ç–∞–ª –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å, –∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –Ω–µ–≥–æ, —Ç–æ –º—ã –ø–æ–ª—É—á–∏–º –≤—ã–∏–≥—Ä—ã—à –∑–∞ —Å—á–µ—Ç —Ç–æ–≥–æ, —á—Ç–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—å 
 –ø—Ä–æ—á—Ç–µ—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–µ –µ–º—É "—Å–æ–æ–±—â–µ–Ω–∏–µ" –ø—Ä—è–º–æ –∏–∑ –∫—ç—à–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞, —è–¥—Ä—É –Ω–µ –ø—Ä–∏–¥–µ—Ç—Å—è [–∏–¥—Ç–∏ –∑–∞ –¥–∞–Ω–Ω—ã–º–∏ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å](https://gist.github.com/jboner/2841832).

## –î–∏–∑–∞–π–Ω

Bird's-eye view

### –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

–£ –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞-–≤–æ—Ä–∫–µ—Ä–∞ –±—É–¥–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (–±—É–¥–µ–º –Ω–∞–∑—ã–≤–∞—Ç—å —ç—Ç—É –æ—á–µ—Ä–µ–¥—å _–ª–æ–∫–∞–ª—å–Ω–æ–π_), –≤–æ—Ä–∫–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å —Å –Ω–µ–π. 

–õ–æ–∫–∞–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –ø–æ–∑–≤–æ–ª—è—Ç –≤–æ—Ä–∫–µ—Ä–∞–º
- –ò–∑–±–µ–≥–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º, —á—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞.
- –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–º—É–Ω–∏—Ü–∏—Ä—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∞–π–±–µ—Ä—ã) –Ω–∞ –æ–¥–Ω–æ–º —è–¥—Ä–µ, —á—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—ç—à–µ–π.

–° –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã, —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª–æ–∂–Ω—è–µ—Ç: 
1) –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏, —Ç–∞–∫ –∫–∞–∫ –∑–∞–¥–∞—á–∏ –º–æ–≥—É—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ –≤–æ—Ä–∫–µ—Ä–∞—Ö –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ. 
2) –ü–∞—Ä–∫–æ–≤–∫—É –≤–æ—Ä–∫–µ—Ä–æ–≤: –±–æ–ª—å—à–µ –Ω–µ–ª—å–∑—è –∞—Ç–æ–º–∞—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Å—Ç–æ—Ç—É –æ–±—â–µ–π –æ—á–µ—Ä–µ–¥–∏ –∏ –∑–∞–ø–∞—Ä–∫–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫ –Ω–∞ –∫–æ–Ω–¥–≤–∞—Ä–µ.

### LIFO-–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–º—É–Ω–∏—Ü–∏—Ä—É—é—â–∏—Ö –∑–∞–¥–∞—á –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –±—É–¥–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å LIFO-–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:

–ö –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ –∫–∞–∂–¥–æ–º –≤–æ—Ä–∫–µ—Ä–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Å–ª–æ—Ç (–±—É–¥–µ–º –Ω–∞–∑—ã–≤–∞—Ç—å –µ–≥–æ _LIFO-—Å–ª–æ—Ç_), –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∑–∞–¥–∞—á–∏ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–æ–π—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å. 

–ó–∞–¥–∞—á–∞, –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤ LIFO-—Å–ª–æ—Ç, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–æ—Ä–∫–µ—Ä–æ–º —É–∂–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Ü–∏–∫–ª–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

### –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏

–î–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞:

- —Ä–∞–∑–¥–µ–ª—è–µ–º–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –∏ 
- –≤–æ—Ä–æ–≤—Å—Ç–≤–æ –∑–∞–¥–∞—á (_work-stealing_).

–í–æ—Ä–∫–µ—Ä—ã —Ä–∞–∑–¥–µ–ª—è—é—Ç –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –µ–º–∫–æ—Å—Ç–∏ (–±—É–¥–µ–º –Ω–∞–∑—ã–≤–∞—Ç—å –µ–µ _–≥–ª–æ–±–∞–ª—å–Ω–æ–π_): –≤ –Ω–µ–µ –æ–Ω–∏ –≤—ã–≥—Ä—É–∂–∞—é—Ç –∏–∑–ª–∏—à–∫–∏ –∑–∞–¥–∞—á –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏, –∏–∑ –Ω–µ–µ –æ–Ω–∏ –∑–∞–±–∏—Ä–∞—é—Ç –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏, –∫–æ–≥–¥–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –æ–ø—É—Å—Ç–æ—à–∞–µ—Ç—Å—è.

–ö–æ–≥–¥–∞ –∏ –ª–æ–∫–∞–ª—å–Ω–∞—è, –∏ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥–∏ –æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø—É—Å—Ç—ã, –≤–æ—Ä–∫–µ—Ä—ã –≤–æ—Ä—É—é—Ç –∑–∞–¥–∞—á–∏ –ø—Ä—è–º–æ –∏–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π –¥—Ä—É–≥–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ ([Work stealing](https://en.wikipedia.org/wiki/Work_stealing)).

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Worker

–ö–ª–∞—Å—Å `Worker` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ—Ç–æ–∫ –ø—É–ª–∞.

#### –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å

[`WorkStealingQueue`](exe/sched/tp/fast/queues/work_stealing_queue.hpp)

–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–π –±—É—Ñ–µ—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á.

- –ú–µ—Ç–æ–¥—ã `TryPush` –∏ `TryPop` –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ—é—â–∏–π –æ—á–µ—Ä–µ–¥—å—é –≤–æ—Ä–∫–µ—Ä.
- –ú–µ—Ç–æ–¥ `Grab` –≤—ã–∑—ã–≤–∞—é—Ç
  - –¥—Ä—É–≥–∏–µ –≤–æ—Ä–∫–µ—Ä—ã –ø—Ä–∏ –≤–æ—Ä–æ–≤—Å—Ç–≤–µ –∑–∞–¥–∞—á,
  - –≤–ª–∞–¥–µ—é—â–∏–π –æ—á–µ—Ä–µ–¥—å—é –≤–æ—Ä–∫–µ—Ä –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á –≤ –æ–±—â—É—é –æ—á–µ—Ä–µ–¥—å –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π.

#### LIFO-—Å–ª–æ—Ç

–í—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Å–ª–æ—Ç –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –≤ –æ–±—Ö–æ–¥ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏.

### Shared State

–í–æ—Ä–∫–µ—Ä—ã –ø—É–ª–∞ —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É, –∏, –∫–∞–∫ —ç—Ç–æ —á–∞—Å—Ç–æ –±—ã–≤–∞–µ—Ç –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö, –∏–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ —Ä–∞–∑–¥–µ–ª—è–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

#### –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å

[`GlobalQueue`](exe/sched/tp/fast/queues/global_queue.hpp)

–†–∞–∑–¥–µ–ª—è–µ–º–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –µ–º–∫–æ—Å—Ç–∏
- –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–¥–∞—á–∏ –æ—Ç `Submit` –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –ø–æ—Ç–æ–∫–æ–≤,
- –ø–æ–º–æ–≥–∞–µ—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏.

#### –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—â–∏–π –≤–æ—Ä–æ–≤—Å—Ç–≤–æ –∑–∞–¥–∞—á, –ø–∞—Ä–∫–æ–≤–∫—É –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—â–∏—Ö –±–µ–∑ –∑–∞–¥–∞—á –≤–æ—Ä–∫–µ—Ä–æ–≤ –≤ `PickNext` –∏ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤ –≤ `Submit`.

–•—Ä–∞–Ω–∏—Ç —Å–ø–∏—Å–æ–∫ —Å–ø—è—â–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤.

----

## –ê–ª–≥–æ—Ä–∏—Ç–º

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ –¥–≤—É—Ö —Å–ª—É—á–∞—è—Ö: 

1) –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–µ—Ä–µ–∑ `Submit` –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É (–Ω–∞–ø—Ä–∏–º–µ—Ä,  `fiber::Go` –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—ã–π —Ñ–∞–π–±–µ—Ä –∏–ª–∏ `fiber::BufferedChannel<T>::Send` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ "–±—É–¥–∏—Ç" –ø–æ–ª—É—á–∞—Ç–µ–ª—è)
  
2) –ö–æ–≥–¥–∞ —Ç–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–∞–π–±–µ—Ä –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `fiber::Mutex::Lock`) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä—É, –∫–æ—Ç–æ—Ä—ã–π –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ 

### `Submit`

–ü—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –Ω—É–∂–Ω–æ

1) –ø–æ–º–µ—Å—Ç–∏—Ç—å –µ–µ –≤ –æ–¥–Ω—É –∏–∑ –æ—á–µ—Ä–µ–¥–µ–π (–∏–ª–∏ LIFO-—Å–ª–æ—Ç) –∏
2) –ø—Ä–æ—Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–º –≤–æ—Ä–∫–µ—Ä–∞–º –æ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ (–µ—Å–ª–∏ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è).

#### –í—ã–±–æ—Ä –æ—á–µ—Ä–µ–¥–∏

##### –í–Ω–µ—à–Ω–∏–π –ø–æ—Ç–æ–∫

–ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ (–ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –ø—É–ª—É) –ø–æ—Ç–æ–∫–∞, —Ç–æ –æ–Ω–∞ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ —Ö–≤–æ—Å—Ç –æ–±—â–µ–π –æ—á–µ—Ä–µ–¥–∏.

##### `Worker`

–ï—Å–ª–∏ `Submit` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω–æ–≥–æ –ø—É–ª–∞ (—Ç.–µ. –∏–∑ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–π –∑–∞–¥–∞—á–∏), —Ç–æ –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ —Ö–≤–æ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ —Ç–µ–∫—É—â–µ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞.

###### Offload

–ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç—Å—è, —Ç–æ
–Ω—É–∂–Ω–æ –≤—ã–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª–æ–≤–∏–Ω—É –∑–∞–¥–∞—á –∏–∑ –Ω–µ–µ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `OffloadTasksToGlobalQueue`.

–ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Ä–∞–±–æ—Ç—É –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π —Å–µ–∫—Ü–∏–∏ –ø—Ä–∏ –≤—ã–≥—Ä—É–∑–∫–µ –∑–∞–¥–∞—á –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å: —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ `GlobalQueue` –∫–∞–∫ [–∏–Ω—Ç—Ä—É–∑–∏–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫](https://gitlab.com/Lipovsky/wheels/-/blob/master/wheels/intrusive/forward_list.hpp),
–¥–æ–±–∞–≤–ª—è–π—Ç–µ –≤ –Ω–µ–≥–æ –ø–∞—á–∫—É –∑–∞–¥–∞—á –∑–∞ O(1) —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `Append`.

#### –ü–æ–¥—Å–∫–∞–∑–∫–∏

–ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –≤ –º–µ—Ç–æ–¥–µ `Submit` —É `task::IScheduler` (–∏ –≤ `FiberHandle::Schedule`) –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä [`SchedulerHint`](exe/sched/task/hint.hpp) ‚Äì –ø–æ–¥—Å–∫–∞–∑–∫—É, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∞–π–±–µ—Ä–æ–≤) –º–æ–∂–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏.

–ü–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–µ–¥–∏—Ä–µ–∫—Ç–∏–≤–Ω—ã: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫—É –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫—É, –Ω–µ –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Ç–æ–≥–æ, –±—ã–ª–∞ –ª–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞ —É—á—Ç–µ–Ω–∞ –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏.

##### `Next`

–ï—Å–ª–∏ `Submit` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ –ø–æ—Ç–æ–∫–∞ –ø—É–ª–∞, —Ç–æ –ø–æ–º–µ—Å—Ç–∏—Ç—å –∑–∞–¥–∞—á—É –≤ LIFO-—Å–ª–æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –≤–æ—Ä–∫—Ä–∞, –≤ –æ–±—Ö–æ–¥ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏. 

–ï—Å–ª–∏ —Å–ª–æ—Ç —É–∂–µ –∑–∞–Ω—è—Ç –¥—Ä—É–≥–æ–π –∑–∞–¥–∞—á–µ–π, —Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –≤—ã—Ç–µ—Å–Ω—è–µ—Ç—Å—è –≤ —Ö–≤–æ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏.

##### `Yield`

–ó–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è –∏–∑ –ø–æ—Ç–æ–∫–∞ –ø—É–ª–∞, –æ–±—Å–ª—É–∂–∏–≤–∞—é—Ç—Å—è —Ç–µ–∫—É—â–∏–º –≤–æ—Ä–∫–µ—Ä–æ–º: –ø–æ–ø–∞–¥–∞—é—Ç –ª–∏–±–æ –≤ –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å, –ª–∏–±–æ –≤ LIFO-—Å–ª–æ—Ç.

–î–ª—è `fiber::Yield` –º—ã —Å–¥–µ–ª–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ: –ø—Ä–∏ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ñ–∞–π–±–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ —Ö–≤–æ—Å—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏.

#### –ù–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –∑–∞–¥–∞—á–∞ –∑–∞–Ω—è–ª–∞ —Å–≤–æ–µ –º–µ—Å—Ç–æ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞, –Ω—É–∂–Ω–æ —á–µ—Ä–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä —Å–æ–æ–±—â–∏—Ç—å –æ–± —ç—Ç–æ–º –¥—Ä—É–≥–∏–º –≤–æ—Ä–∫–µ—Ä–∞–º (–∏, –≤–æ–∑–º–æ–∂–Ω–æ, —Ä–∞–∑–±—É–¥–∏—Ç—å –∫–æ–≥–æ-—Ç–æ –∏–∑ –Ω–∏—Ö).

–ï—Å–ª–∏
- –≤—Å–µ –≤–æ—Ä–∫–µ—Ä—ã –ø—É–ª–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –ª–∏–±–æ
- –µ—Å—Ç—å –≤–æ—Ä–∫–µ—Ä—ã –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ _searching_ (_spinning_ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ Golang)

–∏ –±—É–¥–∏—Ç—å –Ω–∏–∫–æ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ, –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –æ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –¥–æ–ª–∂–Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–æ–º **–±–µ–∑ –∑–∞–ø–∏—Å–∏ –≤ –ø–∞–º—è—Ç—å**, –∏–Ω–∞—á–µ –º—ã –ø–æ–ª—É—á–∏–º —Ç–æ—á–∫—É –∫–æ–Ω—Ç–µ–Ω—à–µ–Ω–∞.

### `PickNext`

–í–æ—Ä–∫–µ—Ä –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–∞–¥–∞—á (–≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞):

1) LIFO-—Å–ª–æ—Ç
2) –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å
3) –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å
4) –õ–æ–∫–∞–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –¥—Ä—É–≥–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ (work stealing)

#### –°–ª–æ—Ç LIFO

–í –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –≤–æ—Ä–∫–µ—Ä –∑–∞–±–∏—Ä–∞–µ—Ç –∑–∞–¥–∞—á—É –∏–∑ —Å–ª–æ—Ç–∞ LIFO.

#### –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å

–ï—Å–ª–∏ LIFO-—Å–ª–æ—Ç –æ–∫–∞–∑–∞–ª—Å—è –ø—É—Å—Ç, –≤–æ—Ä–∫–µ—Ä –∑–∞–±–∏—Ä–∞–µ—Ç –∑–∞–¥–∞—á—É –∏–∑ –≥–æ–ª–æ–≤—ã –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏.

#### Grab

–ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å —Ç–æ–∂–µ –ø—É—Å—Ç–∞, –≤–æ—Ä–∫–µ—Ä –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–±—Ä–∞—Ç—å –ø–∞—á–∫—É –∑–∞–¥–∞—á –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `TryGrabTasksFromGlobalQueue` –∏ –ø–µ—Ä–µ–ª–æ–∂–∏—Ç—å –∏—Ö –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å.

–ö–∞–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Golang –ø–µ—Ä–µ–∫–ª–∞–¥—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –≤ –ª–æ–∫–∞–ª—å–Ω—É—é? –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫?

#### Work stealing

–ï—Å–ª–∏ LIFO-—Å–ª–æ—Ç, –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∏ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –æ–∫–∞–∑–∞–ª–∏—Å—å –ø—É—Å—Ç—ã, –≤–æ—Ä–∫–µ—Ä –≤–æ—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π –¥—Ä—É–≥–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤.

–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ —á–∏—Å–ª–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤–æ—Ä—É—é—â–∏—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤: –µ—Å–ª–∏ –≤ –ø—É–ª–µ –æ—Å—Ç–∞–µ—Ç—Å—è –º–∞–ª–æ —Ä–∞–±–æ—Ç—ã, —Ç–æ –≤–æ—Ä–∫–µ—Ä—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –¥—Ä—É–≥ —É –¥—Ä—É–≥–∞. –ò–∑—É—á–∏—Ç–µ –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ —ç—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞—Ö Golang –∏ Tokio.

##### –†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è

–†–∞–Ω–¥–æ–º–∏–∑–∏—Ä—É–π—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ö–æ–¥–∞ "–∂–µ—Ä—Ç–≤" —Å –ø–æ–º–æ—â—å—é [`mt19937_64`](https://en.cppreference.com/w/cpp/numeric/random).

–î–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∏—Ö—Ä—è –ú–µ—Ä—Å–µ–Ω–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [`twist::ed::std::random_device`](https://gitlab.com/Lipovsky/twist/-/blob/master/twist/ed/stdlike/random.hpp): –æ–Ω –æ–±–µ—Å–ø–µ—á–∏—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤ –≤ —Ä–µ–∂–∏–º–µ —Å–∏–º—É–ª—è—Ü–∏–∏.

–í –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö –ª–æ–∫–∞–ª—å–Ω—ã–π PRNG –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç:
- [`cheaprand`](https://github.com/golang/go/blob/774d5b366ce43ed7e304ea3917e353112df9daf7/src/runtime/rand.go#L182) –≤ [–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ –≥–æ—Ä—É—Ç–∏–Ω Golang](https://github.com/golang/go/blob/774d5b366ce43ed7e304ea3917e353112df9daf7/src/runtime/proc.go#L3578) 
- [`nextInt`](https://github.com/Kotlin/kotlinx.coroutines/blob/c1ba5af8c5d10a3d2f923f89b98f6ab1b394e24d/kotlinx-coroutines-core/jvm/src/scheduling/CoroutineScheduler.kt#L838) –≤ [–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ –∫–æ—Ä—É—Ç–∏–Ω Kotlin](https://github.com/Kotlin/kotlinx.coroutines/blob/c1ba5af8c5d10a3d2f923f89b98f6ab1b394e24d/kotlinx-coroutines-core/jvm/src/scheduling/CoroutineScheduler.kt#L987)
- [`FastRad`](https://github.com/tokio-rs/tokio/blob/d33fdd86a3de75500fe554d6547cf5ad43e006bf/tokio/src/util/rand.rs#L57) –≤ [–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ Tokio](https://github.com/tokio-rs/tokio/blob/d33fdd86a3de75500fe554d6547cf5ad43e006bf/tokio/src/runtime/scheduler/multi_thread/worker.rs#L143)

##### LIFO

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≥–æ—Ä—É—Ç–∏–Ω –≤ Golang –≤–æ—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏ –∏–∑ `runnext`, –Ω–æ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤ Tokio ‚Äì –Ω–µ –≤–æ—Ä—É–µ—Ç. –ß–µ–º –æ–±—É—Å–ª–æ–≤–ª–µ–Ω —Ç–∞–∫–æ–π –≤—ã–±–æ—Ä?

–ú—ã –Ω–µ –±—É–¥–µ–º –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤–æ—Ä–æ–≤—Å—Ç–≤–æ –∑–∞–¥–∞—á –∏–∑ LIFO-—Å–ª–æ—Ç–∞.

#### Fairness

–ö–∞–∂–¥–∞—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤ –ø—É–ª –ø–æ—Ç–æ–∫–æ–≤ –∑–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∞.

–û–¥–Ω–∞–∫–æ –µ—Å–ª–∏ –≤—ã–±–∏—Ä–∞—Ç—å –∑–∞–¥–∞—á—É –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø–ª–∞–Ω–æ–º –≤—ã—à–µ, —Ç–æ –≤–æ–∑–º–æ–∂–Ω—ã —Å—Ü–µ–Ω–∞—Ä–∏–∏, –∫–æ–≥–¥–∞ –∑–∞–¥–∞—á–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ, –Ω–æ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∫–æ–ª—å —É–≥–æ–¥–Ω–æ –¥–æ–ª–≥–æ:

1) –ó–∞–¥–∞—á–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏, –ø—Ä–∏ —ç—Ç–æ–º –≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥—è—Ö –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞—é—Ç—Å—è –∑–∞–¥–∞—á–∏, —Ç–∞–∫ —á—Ç–æ –≤–æ—Ä–∫–µ—Ä—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å.

2) –î–≤–∞ —Ñ–∞–π–±–µ—Ä–∞ –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª—ã, –ø–æ —Ü–∏–∫–ª—É –∑–∞–ø—É—Å–∫–∞—è –¥—Ä—É–≥ –¥—Ä—É–≥–∞ —á–µ—Ä–µ–∑ LIFO-—Å–ª–æ—Ç, —Ç–∞–∫ —á—Ç–æ –≤–æ—Ä–∫–µ—Ä –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å.

–î–ª—è —Ä–µ—à–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π –ø—Ä–æ–±–ª–µ–º—ã –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á **–¥–æ** –ø—Ä–æ–≤–µ—Ä–∫–∏ LIFO-—Å–ª–æ—Ç–∞ (–≤—Å–ø–æ–º–Ω–∏—Ç–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É –î–º–∏—Ç—Ä–∏—è –í—å—é–∫–æ–≤–∞ ‚Äì 61).

–î–ª—è —Ä–µ—à–µ–Ω–∏—è –≤—Ç–æ—Ä–æ–π –ø—Ä–æ–±–ª–µ–º—ã –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ —á–∏—Å–ª–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤ –∑–∞–¥–∞—á —á–µ—Ä–µ–∑ LIFO-—Å–ª–æ—Ç. –ú–æ–∂–Ω–æ –¥—É–º–∞—Ç—å –æ–± —ç—Ç–æ–º —Ç–∞–∫: –∑–∞–¥–∞—á–∞, –≤–∑—è—Ç–∞—è –∏–∑ LIFO-—Å–ª–æ—Ç–∞, –Ω–∞—Å–ª–µ–¥—É–µ—Ç –∫–≤–∞–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–µ–¥—à–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–¥–∞—á–∏.

#### Maintenance

(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í–æ—Ä–∫–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –Ω–∞—à–µ–ª –∑–∞–¥–∞—á –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å—Å—è [—Å–±–æ—Ä–∫–æ–π –º—É—Å–æ—Ä–∞](https://github.com/golang/go/blob/9effeeab27de2a8f75a1050ce879ba8db3abb406/src/runtime/proc.go#L3297): –ø–æ—á–∏—Å—Ç–∏—Ç—å —Ç—Ä–µ–¥-–ª–æ–∫–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
–Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –º–µ–Ω–µ–¥–∂–µ—Ä–µ –ø–∞–º—è—Ç–∏ [hazard pointers](/tasks/lf/hazard_ptr).

#### Idle

–ï—Å–ª–∏ –≤ –ø—É–ª–µ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–¥–∞—á –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, –≤–æ—Ä–∫–µ—Ä –¥–æ–ª–∂–µ–Ω –ø–∞—Ä–∫–æ–≤–∞—Ç—å—Å—è –Ω–∞ `futex` –∏ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–µ –≤—Ä–µ–º—è.

### –ü–∞—Ä–∫–æ–≤–∫–∞

–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–∫–æ–≤–∫–∏ —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã **–∞—Ç–æ–º–∞—Ä–Ω–æ**
1) –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∏ –≤ –æ–¥–Ω–æ–π –∏–∑ –æ—á–µ—Ä–µ–¥–µ–π –ø—É–ª–∞ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –∑–∞–¥–∞—á, –∏ –∑–∞—Ç–µ–º
2) –∑–∞–ø–∞—Ä–∫–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫ –Ω–∞ —Ñ—å—é—Ç–µ–∫—Å–µ.

–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã –Ω–µ –±—É–¥–∏—Ç—å –≤–æ—Ä–∫–µ—Ä–æ–≤
–Ω–∞ –∫–∞–∂–¥—ã–π `Submit`.

–†–µ—à–µ–Ω–∏–µ:
- –î–≤—É—Ö—Ñ–∞–∑–Ω–∞—è –ø–∞—Ä–∫–æ–≤–∫–∞
- –ö–∞—Å–∫–∞–¥–Ω–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ

–ò–∑—É—á–∏—Ç–µ [–º–µ—Ö–∞–Ω–∏–∑–º –ø–∞—Ä–∫–æ–≤–∫–∏ –ø–æ—Ç–æ–∫–æ–≤](https://github.com/golang/go/blob/d2552037426fe5a190c74172562d897d921fe311/src/runtime/proc.go#L31) –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ Golang.

–ò–∑—É—á–∏—Ç–µ [—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é](https://github.com/tokio-rs/tokio/blob/master/tokio/src/runtime/scheduler/multi_thread/idle.rs) —ç—Ç–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ [Tokio](https://github.com/tokio-rs/tokio).

## References

### Work Stealing

- [Scheduling Multithreaded Computations by Work Stealing](http://supertech.csail.mit.edu/papers/steal.pdf)
- https://en.wikipedia.org/wiki/Work_stealing

### –î–∏–∑–∞–π–Ω

- üî• [Go scheduler: Implementing language with lightweight concurrency](https://www.youtube.com/watch?v=-K11rY57K7k)
- [Making the Tokio scheduler 10x faster](https://tokio.rs/blog/2019-10-scheduler)
- [Threads at Scale](https://www.youtube.com/watch?v=PLApcas04V0)

### –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [Golang](https://github.com/golang/go/blob/master/src/runtime/proc.go)
- [Tokio (Rust)](https://github.com/tokio-rs/tokio/tree/master/tokio/src/runtime/scheduler/multi_thread)
- [Kotlin Coroutines](https://github.com/Kotlin/kotlinx.coroutines/blob/master/kotlinx-coroutines-core/jvm/src/scheduling/CoroutineScheduler.kt)
- [Cats Effect (Scala)](https://github.com/typelevel/cats-effect/blob/series/3.x/core/jvm/src/main/scala/cats/effect/unsafe/WorkStealingThreadPool.scala)


----

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Contention

–ï—Å–ª–∏ –ø—É–ª –∑–∞–≥—Ä—É–∂–µ–Ω –∑–∞–¥–∞—á–∞–º–∏, —Ç–æ –≤–æ—Ä–∫–µ—Ä—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø–∏—Å–∏ –≤ –æ–±—â–∏–µ —è—á–µ–π–∫–∏ –ø–∞–º—è—Ç–∏ –≤ —Ü–∏–∫–ª–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤ `Submit`.

### –ê–ª–ª–æ–∫–∞—Ü–∏–∏

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–µ –¥–æ–ª–∂–µ–Ω –∞–ª–ª–æ—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –ø–∞–º—è—Ç—å –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ / –≤—ã–±–æ—Ä–µ –∑–∞–¥–∞—á:
- –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å ‚Äì —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±—É—Ñ–µ—Ä —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –∑–∞–¥–∞—á–∏
- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å ‚Äì –∏–Ω—Ç—Ä—É–∑–∏–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞–Ω–¥–æ–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Twist ‚Äì —Ä–∞–∑–º–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á.

–ê–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```cpp
static constexpr size_t kLocalQueueCapacity = twist::build::kTwisted ? 7 : 256;
```

–ú–∞–ª–µ–Ω—å–∫–∏–π —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ –ø–æ–∑–≤–æ–ª–∏—Ç Twist –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –≤–æ–∑–Ω–∏–∫–∞—é—â–∏–µ –ø—Ä–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–µ –Ω–∞–≥—Ä—É–∑–∫–∏.

### –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ—Ñ–∏–ª–∏—Ä—É–π—Ç–µ –≤–∞—à—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –Ω–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∏–∑ [`workloads`](workloads/main.cpp) —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –Ω–∞ —á—Ç–æ –≤—ã —Ä–∞—Å—Ö–æ–¥—É–µ—Ç–µ –≤—Ä–µ–º—è –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏, –∏–∑—É—á–∞–π—Ç–µ [flame graphs](https://www.brendangregg.com/flamegraphs.html).

–î–æ–±–∞–≤–ª—è–π—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏, –æ–Ω–∏ –ø–æ–º–æ–≥—É—Ç –≤–∞–º –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞.

–í —Ä–µ–ª–∏–∑–Ω–æ–π —Å–±–æ—Ä–∫–µ –∫–æ–¥ –±—É–¥–µ—Ç —Å–æ–±–∏—Ä–∞—Ç—å—Å—è —Å —Ö–æ—Ä–æ—à–∏–º –∞–ª–ª–æ–∫–∞—Ç–æ—Ä–æ–º: https://github.com/microsoft/mimalloc

### –ú–µ—Ç—Ä–∏–∫–∏

–°–æ–±–∏—Ä–∞–π—Ç–µ [–º–µ—Ç—Ä–∏–∫–∏](exe/sched/tp/fast/metrics.hpp):

- –°–∫–æ–ª—å–∫–æ –∑–∞–¥–∞—á –±—ã–ª–æ –∑–∞–ø—É—â–µ–Ω–æ —á–µ—Ä–µ–∑ LIFO-—Å–ª–æ—Ç / –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å / –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å
- –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤–æ—Ä–∫–µ—Ä—ã –≤–æ—Ä–æ–≤–∞–ª–∏ –∑–∞–¥–∞—á–∏, –≤—ã–≥—Ä—É–∂–∞–ª–∏ –∑–∞–¥–∞—á–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å, –∑–∞–±–∏—Ä–∞–ª–∏ –∑–∞–¥–∞—á–∏ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
- –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤–æ—Ä–∫–µ—Ä—ã –ø–∞—Ä–∫–æ–≤–∞–ª–∏—Å—å –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∑–∞–¥–∞—á
- –∏ —Ç.–ø.

–ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–º–æ–≥—É—Ç –ø–æ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–∞—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –Ω–∞–≥—Ä—É–∑–∫–∏.

–°–æ–±–∏—Ä–∞–π—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ, –±–µ–∑ —Ä–∞–∑–¥–µ–ª—è–µ–º—ã—Ö –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö —Å—á–µ—Ç—á–∏–∫–æ–≤.

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è. –¢–∞–∫ –±—É–¥–µ—Ç —É–¥–æ–±–Ω–µ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –≤–ª–∏—è–Ω–∏–µ —ç—Ç–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –Ω–∞–≥—Ä—É–∑–∫–∏.

---

## –ó–∞–¥–∞–Ω–∏–µ

1) –†–µ–∞–ª–∏–∑—É–π—Ç–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –æ—á–µ—Ä–µ–¥—è–º–∏ –∏ –æ–±—â–µ–π –æ—á–µ—Ä–µ–¥—å—é –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
2) –†–µ–∞–ª–∏–∑—É–π—Ç–µ work stealing
3) –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ LIFO-–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ –ø—Ä–∏–º–∏—Ç–∏–≤–∞—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ LIFO –¥–∞–µ—Ç –≤—ã–∏–≥—Ä—ã—à –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4) –†–µ–∞–ª–∏–∑—É–π—Ç–µ –ø–∞—Ä–∫–æ–≤–∫—É –≤–æ—Ä–∫–µ—Ä–æ–≤ –∏ –∫–∞—Å–∫–∞–¥–Ω–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ
5) (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ [—Ç–∞–π–º–µ—Ä—ã](timer.md)
6) (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ —Ä–∞–±–æ—Ç—É —Å —Å–µ—Ç—å—é

## –¢–µ—Å—Ç—ã

–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø—É–ª–∞ –ø–æ—Ç–æ–∫–æ–≤, –∞ `sched::ThreadPool`, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –≤ [exe/sched/thread_pool.hpp](exe/sched/thread_pool.hpp).

–í—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —ç—Ç–æ—Ç alias –º–µ–∂–¥—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏ –≤–æ –≤—Ä–µ–º—è –æ—Ç–ª–∞–¥–∫–∏.
